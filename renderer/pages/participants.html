<!-- Participants Page Content -->
<!-- Loaded dynamically by router.js -->

<div id="section-participants" class="content-section active-section">
  <div class="card">
    <div class="card-header">
      <div class="card-title">Participant Presets</div>
      <div class="card-header-actions">
        <button id="create-new-preset-btn" class="btn btn-primary">
          <span class="btn-icon">+</span>
          New Preset
        </button>
        <button id="import-csv-preset-btn" class="btn btn-secondary">
          <span class="btn-icon">üìÑ</span>
          Import CSV
        </button>
        <button id="import-json-preset-btn" class="btn btn-secondary">
          <span class="btn-icon">üíæ</span>
          Import JSON
        </button>
      </div>
    </div>
    <div class="card-body">
      <!-- PDF Drop Zone -->
      <div id="pdf-drop-zone" class="pdf-drop-zone">
        <div class="drop-zone-content">
          <div class="drop-zone-icon">üìÑ</div>
          <div class="drop-zone-text">
            <h4>Drop your Start List PDF here</h4>
            <p>or click to browse files</p>
          </div>
          <div class="drop-zone-hint">
            <span class="ai-chip">ü§ñ AI-Powered</span>
            Supports official FIA, FIM, and race organizer entry lists
          </div>
        </div>
        <input type="file" id="pdf-file-input" accept=".pdf" style="display: none;">
      </div>

      <div class="info-box mb-md">
        <span class="info-icon">‚ÑπÔ∏è</span>
        <div class="info-text">
          <strong>What are Participant Presets?</strong> Presets help improve AI recognition accuracy by providing expected race numbers, driver names, and sponsor information.
          <a href="https://www.racetagger.cloud/blog/3-CSV-Starting-Lists-for-Race-Photography" target="_blank" style="color: var(--primary-color); text-decoration: underline;">Learn more ‚Üí</a>
        </div>
      </div>
      <div id="presets-list-container">
        <div class="empty-state" id="empty-presets-state">
          <div class="empty-icon">üë•</div>
          <h3>No participant presets yet</h3>
          <p>Create your first preset to start managing participants efficiently</p>
          <button class="btn btn-primary" onclick="createNewPreset()">Create First Preset</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Preset Editor Modal -->
  <div id="preset-editor-modal" class="modal">
    <div class="modal-content participants-modal">
      <div class="modal-header">
        <h2 id="preset-editor-title">New Participant Preset</h2>
        <button class="modal-close" onclick="closePresetEditor()">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Container affiancato per Preset Info + Folder Organization -->
        <div class="preset-header-row">
          <!-- Preset Info -->
          <div class="preset-info-section">
            <div class="form-group text-white">
              <label for="preset-name">Preset Name *</label>
              <input type="text" id="preset-name" placeholder="e.g., Monza 2024 GT Championship">
            </div>
            <div class="form-group">
              <label for="preset-description">Description</label>
              <input type="text" id="preset-description" placeholder="Optional description">
            </div>
            <div class="form-group">
              <label for="preset-sport-category">
                Sport Category *
                <span class="label-hint" title="Presets are filtered by sport category in the analysis page">‚ÑπÔ∏è</span>
              </label>
              <select id="preset-sport-category" class="form-control">
                <option value="">Select a sport category...</option>
                <!-- Options loaded dynamically from sport_categories -->
              </select>
              <div class="form-hint">
                This preset will only appear when this sport category is selected
              </div>
            </div>
          </div>

          <!-- Folder Organization Section -->
          <div class="folder-organization-section">
            <div class="section-header">
              <h3>üìÅ Personalize your Folder Organization</h3>
              <p class="form-text">Create custom folders to organize photos. You can assign each participant to one or more folders.</p>
            </div>

            <div class="custom-folders-manager">
              <div class="folders-list" id="custom-folders-list">
                <!-- Custom folders will be added here dynamically -->
                <p class="empty-folders-message" id="empty-folders-message">No custom folders yet. Click "Add Folder" to create one.</p>
              </div>
              <button type="button" class="btn btn-secondary btn-sm" onclick="addCustomFolder()">
                <span class="btn-icon">+</span>
                Add Folder
              </button>
            </div>

            <div class="folder-info-box">
              <span class="info-icon">‚ÑπÔ∏è</span>
              <div class="info-text">
                <strong>How it works:</strong><br>
                ‚Ä¢ <strong>No folders assigned:</strong> Photos organized by race number (e.g., "50/")<br>
                ‚Ä¢ <strong>One or more folders assigned:</strong> Photos <strong>copied to ALL</strong> assigned folders<br>
                <br>
                <strong>Example:</strong> Number 50 with Folder 1 = "Ferrari" and Folder 2 = "50-Pilota"<br>
                ‚Üí Photos copied to <strong>BOTH</strong> "Ferrari/" AND "50-Pilota/" folders for easy client delivery.
              </div>
            </div>
          </div>
        </div>

        <!-- Participants Table -->
        <div class="participants-table-section">
          <div class="table-header">
            <h3>Participants</h3>
            <div class="table-actions">
              <button class="btn btn-secondary btn-sm" onclick="openParticipantEditModal(-1)">
                <span class="btn-icon">+</span>
                Add Participant
              </button>
              <button class="btn btn-secondary btn-sm" onclick="clearAllParticipants()">
                <span class="btn-icon">üóëÔ∏è</span>
                Clear All
              </button>
            </div>
          </div>

          <div class="participants-table-container">
            <table id="participants-table" class="participants-table sortable asc">
              <thead>
                <tr>
                  <th>Num</th>
                  <th>Driver</th>
                  <th>Category</th>
                  <th>Team</th>
                  <th>Plate</th>
                  <th class="no-sort">Actions</th>
                </tr>
              </thead>
              <tbody id="participants-tbody">
                <!-- Participants rows will be added here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closePresetEditor()">Cancel</button>
        <button class="btn btn-primary" onclick="savePreset()" id="save-preset-btn">
          <span class="btn-icon">üíæ</span>
          Save Preset
        </button>
      </div>
    </div>
  </div>

  <!-- Folder Name Input Modal -->
  <div id="folder-name-modal" class="modal">
    <div class="modal-content folder-name-modal">
      <div class="modal-header">
        <h2>Add Custom Folder</h2>
        <button class="modal-close" onclick="closeFolderNameModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="folder-name-input text-white">Folder Name *</label>
          <div class="folder-input-container">
            <input type="text" id="folder-name-input" class="form-input" placeholder="e.g., Ferrari  or  {number}-{name}" autofocus autocomplete="off">
            <datalist id="keyword-suggestions">
              <option value="{number}">Race number</option>
              <option value="{name}">Driver name</option>
              <option value="{team}">Team name</option>
              <option value="{category}">Category</option>
              <option value="{tag}">Custom tag</option>
            </datalist>
            <div id="keyword-dropdown" class="keyword-dropdown" style="display: none;"></div>
          </div>
        </div>

        <div class="folder-modal-tip">
          <span class="tip-icon">üí°</span>
          <div class="tip-content">
            <strong>Pro Tip: Use Dynamic Keywords!</strong><br>
            Type <strong>{</strong> to see available keywords that will be replaced automatically:<br>
            ‚Ä¢ <code>{number}</code> = Race number (e.g., "51")<br>
            ‚Ä¢ <code>{name}</code> = Driver name<br>
            ‚Ä¢ <code>{team}</code> = Team name<br>
            ‚Ä¢ <code>{category}</code> = Category<br>
            ‚Ä¢ <code>{tag}</code> = Custom tag<br>
            <br>
            <strong>Example:</strong> <code>{number}-{name}</code> ‚Üí "51-A. Pier Guidi"
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeFolderNameModal()">Cancel</button>
        <button class="btn btn-primary" onclick="confirmAddFolder()">
          <span class="btn-icon">+</span>
          Add Folder
        </button>
      </div>
    </div>
  </div>

  <!-- Participant Edit Modal - Fullscreen Layout -->
  <div id="participant-edit-modal" class="modal">
    <div class="modal-content participant-edit-modal-fullscreen">
      <div class="modal-header">
        <h2 id="participant-edit-title">Edit Participant</h2>
        <button class="modal-close" onclick="closeParticipantEditModal()">&times;</button>
      </div>

      <div class="modal-body participant-edit-body">
        <!-- Three-column layout -->
        <div class="participant-edit-grid">

          <!-- COLUMN 1: IPTC Metadata (Written to file) -->
          <div class="participant-edit-column">
            <div class="column-header metadata-column">
              <div class="column-badge badge-written">
                <span class="badge-icon">üìù</span>
                <span class="badge-text">WRITTEN TO FILE</span>
              </div>
              <h3 class="column-title">IPTC Metadata</h3>
              <p class="column-description">These fields are embedded directly into your image files as IPTC keywords</p>
            </div>

            <div class="column-content">
              <!-- Number -->
              <div class="form-group">
                <label>
                  Race Number
                  <span class="field-destination">‚Üí IPTC:Keywords</span>
                </label>
                <input type="text" id="edit-numero" class="form-input form-input-metadata" placeholder="51">
                <small class="form-hint">Optional for Team Principal, VIP, mechanics. Required for drivers.</small>
              </div>

              <!-- Drivers (Tag Input) -->
              <div class="form-group">
                <label>
                  Drivers *
                  <span class="field-destination">‚Üí IPTC:Keywords</span>
                </label>
                <div class="tag-input-container" id="edit-drivers-container">
                  <div class="tag-input-tags" id="edit-drivers-tags"></div>
                  <input type="text" id="edit-drivers-input" class="tag-input-field" placeholder="Type driver name and press Enter">
                </div>
                <small class="form-hint">Press Enter or comma to add each driver. Click √ó to remove.</small>
                <!-- Hidden field to store comma-separated value -->
                <input type="hidden" id="edit-nome" value="">
              </div>

              <!-- Category -->
              <div class="form-group">
                <label>
                  Category
                  <span class="field-destination">‚Üí IPTC:Keywords</span>
                </label>
                <input type="text" id="edit-categoria" class="form-input form-input-metadata" placeholder="GT3, F1, MotoGP...">
              </div>

              <!-- Team -->
              <div class="form-group">
                <label>
                  Team
                  <span class="field-destination">‚Üí IPTC:Keywords</span>
                </label>
                <input type="text" id="edit-squadra" class="form-input form-input-metadata" placeholder="Ferrari">
              </div>

              <!-- Meta Tag -->
              <div class="form-group">
                <label>
                  Meta Tag
                  <span class="field-destination">‚Üí IPTC:Keywords</span>
                </label>
                <input type="text" id="edit-metatag" class="form-input form-input-metadata" placeholder="Pro Driver, Champion 2024...">
                <small class="form-hint">Custom keywords added to the image</small>
              </div>
            </div>
          </div>

          <!-- COLUMN 2: AI Matching (NOT written to file) -->
          <div class="participant-edit-column">
            <div class="column-header matching-column">
              <div class="column-badge badge-matching">
                <span class="badge-icon">üîç</span>
                <span class="badge-text">AI MATCHING ONLY</span>
              </div>
              <h3 class="column-title">Recognition Helpers</h3>
              <p class="column-description">These fields help AI identify participants more accurately but are <strong>NOT</strong> written to files</p>
            </div>

            <div class="column-content">
              <!-- Sponsors -->
              <div class="form-group">
                <label>
                  Sponsors
                  <span class="field-destination field-destination-matching">‚Üí AI only</span>
                </label>
                <input type="text" id="edit-sponsor" class="form-input form-input-matching" placeholder="Shell, Santander, Ray-Ban">
                <small class="form-hint">Comma-separated list. Helps AI confirm participant identity when sponsor logos are visible</small>
              </div>

              <!-- Plate Number -->
              <div class="form-group">
                <label>
                  Plate Number üöó
                  <span class="field-destination field-destination-matching">‚Üí AI only</span>
                </label>
                <input type="text" id="edit-plate-number" class="form-input form-input-matching" placeholder="AB123CD" style="text-transform: uppercase;">
                <small class="form-hint">License plate for future car recognition feature</small>
              </div>

              <!-- Info box -->
              <div class="matching-info-box">
                <div class="info-icon">üí°</div>
                <div class="info-content">
                  <strong>How AI Matching Works</strong>
                  <p>When analyzing images, the AI looks for sponsor logos and other visual cues to confirm which participant is in the photo. This improves accuracy especially when race numbers are partially obscured.</p>
                </div>
              </div>
            </div>
          </div>

          <!-- COLUMN 3: Folder Organization -->
          <div class="participant-edit-column">
            <div class="column-header folder-column">
              <div class="column-badge badge-folder">
                <span class="badge-icon">üìÅ</span>
                <span class="badge-text">OUTPUT ORGANIZATION</span>
              </div>
              <h3 class="column-title">Folder Assignment</h3>
              <p class="column-description">Organize exported photos into custom folders for easy delivery to clients</p>
            </div>

            <div class="column-content">
              <!-- Folder 1 -->
              <div class="form-group">
                <label>
                  Primary Folder
                  <span class="field-destination field-destination-folder">‚Üí Export</span>
                </label>
                <select id="edit-folder-1" class="form-input form-input-folder">
                  <option value="">None</option>
                </select>
                <small class="form-hint">Main output folder for this participant</small>
              </div>

              <!-- Folder 2 -->
              <div class="form-group">
                <label>
                  Secondary Folder
                  <span class="field-destination field-destination-folder">‚Üí Export</span>
                </label>
                <select id="edit-folder-2" class="form-input form-input-folder">
                  <option value="">None</option>
                </select>
              </div>

              <!-- Folder 3 -->
              <div class="form-group">
                <label>
                  Additional Folder
                  <span class="field-destination field-destination-folder">‚Üí Export</span>
                </label>
                <select id="edit-folder-3" class="form-input form-input-folder">
                  <option value="">None</option>
                </select>
              </div>

              <!-- Info box -->
              <div class="folder-info-box-enhanced">
                <div class="info-icon">üìã</div>
                <div class="info-content">
                  <strong>Multi-folder Export</strong>
                  <p>Photos will be <strong>copied to ALL</strong> selected folders during export. Perfect for delivering to multiple clients or organizing by team AND driver.</p>
                </div>
              </div>
            </div>
          </div>

        </div>

        <!-- FACE RECOGNITION SECTION -->
        <div class="form-section face-photos-section" id="face-photos-section">
          <h3 class="section-title">
            Face Recognition Photos
            <span class="badge badge-beta" title="Experimental feature">BETA</span>
          </h3>
          <p class="section-description">Upload up to 5 reference photos for face recognition. Best results with clear, front-facing photos.</p>

          <div class="face-photos-grid" id="face-photos-grid">
            <!-- Face photos will be rendered here dynamically -->
            <div class="face-photo-placeholder" id="face-photo-placeholder-0">
              <div class="placeholder-content">
                <span class="placeholder-icon">üì∑</span>
                <span class="placeholder-text">Add Photo</span>
              </div>
            </div>
            <div class="face-photo-placeholder" id="face-photo-placeholder-1">
              <div class="placeholder-content">
                <span class="placeholder-icon">+</span>
              </div>
            </div>
            <div class="face-photo-placeholder" id="face-photo-placeholder-2">
              <div class="placeholder-content">
                <span class="placeholder-icon">+</span>
              </div>
            </div>
            <div class="face-photo-placeholder" id="face-photo-placeholder-3">
              <div class="placeholder-content">
                <span class="placeholder-icon">+</span>
              </div>
            </div>
            <div class="face-photo-placeholder" id="face-photo-placeholder-4">
              <div class="placeholder-content">
                <span class="placeholder-icon">+</span>
              </div>
            </div>
          </div>

          <div class="face-photos-actions">
            <input type="file" id="face-photo-input" accept="image/*" style="display: none;" onchange="handleFacePhotoSelect(event)">
            <button type="button" class="btn btn-secondary btn-sm" id="add-face-photo-btn" onclick="triggerFacePhotoUpload()">
              <span class="btn-icon">üì∑</span>
              Add Photo
            </button>
            <span class="photo-count-label" id="face-photo-count">0/5 photos</span>
          </div>

          <div class="face-photos-info">
            <span class="info-icon">üí°</span>
            <div class="info-text">
              <strong>Tips for best results:</strong>
              <ul>
                <li>Use clear, well-lit photos</li>
                <li>Front-facing portraits work best</li>
                <li>Include photos without helmet for motorsport</li>
                <li>Variety helps: podium, portrait, action shots</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <div class="footer-legend">
          <span class="legend-item legend-written"><span class="legend-dot"></span> Written to file</span>
          <span class="legend-item legend-matching"><span class="legend-dot"></span> AI matching only</span>
          <span class="legend-item legend-folder"><span class="legend-dot"></span> Export organization</span>
        </div>
        <div class="footer-actions">
          <button class="btn btn-secondary" onclick="closeParticipantEditModal()">Cancel</button>
          <button class="btn btn-primary" onclick="saveParticipantEdit()">
            <span class="btn-icon">üíæ</span>
            Save Changes
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Folder Name Modal -->
  <div id="edit-folder-modal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
      <div class="modal-header">
        <h2>Edit Folder Name</h2>
        <button class="modal-close" onclick="closeEditFolderModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="edit-folder-name-input">Folder Name *</label>
          <input
            type="text"
            id="edit-folder-name-input"
            class="form-input"
            placeholder="Enter folder name"
            onkeypress="if(event.key === 'Enter') saveEditedFolderName()"
          >
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeEditFolderModal()">Cancel</button>
        <button class="btn btn-primary" onclick="saveEditedFolderName()">
          <span class="btn-icon">üíæ</span>
          Save
        </button>
      </div>
    </div>
  </div>

  <!-- CSV Import Modal -->
  <div id="csv-import-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Import Participants from CSV</h2>
        <button class="modal-close" onclick="closeCsvImportModal()">&times;</button>
      </div>
      <div class="modal-body" style="padding: 2rem;">
        <!-- Preset Name Section -->
        <div class="form-group" style="margin-bottom: 2rem;">
          <label class="csv-preset-name" for="csv-preset-name" style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: #fff;">
            üìã Preset Name *
          </label>
          <input
            type="text"
            id="csv-preset-name"
            class="form-input-sm"
            placeholder="e.g., Monza 2024 Starting List"
            style="width: 100%; font-size: 1rem; padding: 0.75rem 1rem;"
          >
          <small class="form-hint" style="display: block; margin-top: 0.5rem;">
            Give this participant list a meaningful name
          </small>
        </div>

        <!-- CSV File Upload Section -->
        <div class="form-group" style="margin-bottom: 2rem;">
          <label class for="csv-file-input" style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: var(--text-dark);">
            üìÇ CSV File *
          </label>
          <div style="border: 2px dashed var(--border-color); border-radius: 8px; padding: 2rem; text-align: center; transition: all 0.2s ease; background: var(--surface-color-light);">
            <input
              type="file"
              id="csv-file-input"
              accept=".csv"
              onchange="previewCsvFile()"
              style="margin-bottom: 1rem; font-size: 0.95rem;"
            >
            <div style="color: var(--text-secondary); font-size: 0.875rem;">
              <strong>Expected columns:</strong> number, name, team, category, navigator, sponsor, metatag<br>
              <small>Upload a CSV file with participant data</small>
            </div>
            <button class="btn btn-secondary btn-sm" onclick="downloadCsvTemplate()" style="margin-top: 1rem;">
              <span class="btn-icon">üì•</span>
              Download CSV Template
            </button>
          </div>
        </div>

        <!-- CSV Preview Section -->
        <div id="csv-preview" class="csv-preview-container" style="display: none; margin-top: 2rem;">
          <h4 style="color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center;">
            üëÅÔ∏è Preview (first 5 rows):
          </h4>
          <div id="csv-preview-table" style="border-radius: 6px; overflow: hidden; border: 1px solid var(--border-color);"></div>
          <small class="form-hint" style="display: block; margin-top: 0.75rem; text-align: center;">
            Verify the data looks correct before importing
          </small>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeCsvImportModal()">Cancel</button>
        <button class="btn btn-primary" onclick="importCsvPreset()" id="import-csv-btn" disabled>
          <span class="btn-icon">üì•</span>
          Import
        </button>
      </div>
    </div>
  </div>

  <!-- JSON Import Modal -->
  <div id="json-import-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Import Complete Preset (JSON)</h2>
        <button class="modal-close" onclick="closeJsonImportModal()">&times;</button>
      </div>
      <div class="modal-body" style="padding: 2rem;">
        <!-- JSON File Upload Section -->
        <div class="form-group" style="margin-bottom: 2rem;">
          <label for="json-file-input" style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: #000;">
            üìÇ JSON Preset File *
          </label>
          <div style="border: 2px dashed var(--border-color); border-radius: 8px; padding: 2rem; text-align: center; transition: all 0.2s ease; background: var(--surface-color-light);">
            <input
              type="file"
              id="json-file-input"
              accept=".json"
              onchange="previewJsonFile()"
              style="margin-bottom: 1rem; font-size: 0.95rem;"
            >
            <div style="color: var(--text-secondary); font-size: 0.875rem;">
              <strong>Complete preset backup</strong><br>
              <small>Import a previously exported JSON preset with all settings</small>
            </div>
          </div>
        </div>

        <!-- JSON Preview Section -->
        <div id="json-preview" class="json-preview-container" style="display: none; margin-top: 2rem;">
          <h4 style="color: var(--text-primary); margin-bottom: 1rem; display: flex; align-items: center;">
            üëÅÔ∏è Preset Preview:
          </h4>
          <div id="json-preview-content" style="background: var(--surface-color-light); padding: 1.5rem; border-radius: 6px; border: 1px solid var(--border-color);">
            <div class="preview-row" style="margin-bottom: 0.75rem;">
              <strong>Name:</strong> <span id="json-preview-name">-</span>
            </div>
            <div class="preview-row" style="margin-bottom: 0.75rem;">
              <strong>Description:</strong> <span id="json-preview-description">-</span>
            </div>
            <div class="preview-row" style="margin-bottom: 0.75rem;">
              <strong>Participants:</strong> <span id="json-preview-participants-count">0</span>
            </div>
            <div class="preview-row">
              <strong>Custom Folders:</strong> <span id="json-preview-folders">None</span>
            </div>
          </div>
          <small class="form-hint" style="display: block; margin-top: 0.75rem; text-align: center;">
            This will create a new preset with all participants and settings
          </small>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeJsonImportModal()">Cancel</button>
        <button class="btn btn-primary" onclick="importJsonPreset()" id="import-json-btn" disabled>
          <span class="btn-icon">üì•</span>
          Import Preset
        </button>
      </div>
    </div>
  </div>

  <!-- PDF Import Modal -->
  <div id="pdf-import-modal" class="modal">
    <div class="modal-content pdf-import-modal">
      <div class="modal-header">
        <h2>
          <span class="ai-badge-header">ü§ñ AI</span>
          Import Participants from PDF
        </h2>
        <button class="modal-close" onclick="closePdfImportModal()">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Processing State -->
        <div id="pdf-processing-state" class="pdf-state" style="display: none;">
          <div class="processing-animation">
            <div class="ai-loader">
              <div class="ai-loader-ring"></div>
              <div class="ai-loader-icon">ü§ñ</div>
            </div>
            <h3>AI is analyzing your document...</h3>
            <p id="pdf-processing-status">Validating document type</p>
          </div>
        </div>

        <!-- Validation Error State -->
        <div id="pdf-validation-error" class="pdf-state" style="display: none;">
          <div class="validation-error-content">
            <div class="error-icon">‚ùå</div>
            <h3 id="pdf-error-title">Document Not Recognized</h3>
            <p id="pdf-error-message">The uploaded document doesn't appear to be a valid entry list or start list.</p>
            <div class="error-details" id="pdf-error-details"></div>
            <button class="btn btn-secondary" onclick="resetPdfImport()">
              <span class="btn-icon">üîÑ</span>
              Try Another File
            </button>
          </div>
        </div>

        <!-- Preview State -->
        <div id="pdf-preview-state" class="pdf-state" style="display: none;">
          <!-- Preset Name Section -->
          <div class="form-group text-white>
            <label for="pdf-preset-name">
              üìã Preset Name *
            </label>
            <input
              type="text"
              id="pdf-preset-name"
              class="form-input-sm"
              placeholder="e.g., Monza 2024 Starting List"
            >
            <small class="form-hint">
              Give this participant list a meaningful name
            </small>
          </div>

          <!-- Document Info -->
          <div class="pdf-document-info">
            <div class="doc-info-header">
              <span class="doc-type-badge" id="pdf-doc-type-badge">Entry List</span>
            </div>
            <div class="doc-info-details">
              <div class="doc-info-item">
                <span class="doc-info-label">Event:</span>
                <span class="doc-info-value" id="pdf-event-name">-</span>
              </div>
              <div class="doc-info-item">
                <span class="doc-info-label">Category:</span>
                <span class="doc-info-value" id="pdf-category-name">-</span>
              </div>
              <div class="doc-info-item">
                <span class="doc-info-label">Participants:</span>
                <span class="doc-info-value" id="pdf-participants-count">0</span>
              </div>
            </div>
          </div>

          <!-- Extracted Participants Preview -->
          <div class="pdf-preview-section">
            <h4>
              üëÅÔ∏è Extracted Participants (Preview):
            </h4>
            <div class="pdf-preview-table-container">
              <table class="pdf-preview-table">
                <thead>
                  <tr>
                    <th>Num</th>
                    <th>Driver</th>
                    <th>Team</th>
                    <th>Category</th>
                  </tr>
                </thead>
                <tbody id="pdf-preview-tbody">
                  <!-- Preview rows will be added here -->
                </tbody>
              </table>
            </div>
            <small class="form-hint" id="pdf-preview-hint">
              Showing first 10 participants. Full list will be imported.
            </small>
          </div>

          <!-- Warning for partial extraction -->
          <div id="pdf-extraction-warning" class="extraction-warning" style="display: none;">
            <span class="warning-icon">‚ö†Ô∏è</span>
            <div class="warning-content">
              <strong>Partial Extraction</strong>
              <p id="pdf-warning-message">Some fields could not be extracted. You can edit them after import.</p>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer" id="pdf-modal-footer">
        <button class="btn btn-secondary" onclick="closePdfImportModal()">Cancel</button>
        <button class="btn btn-primary" onclick="importPdfPreset()" id="import-pdf-btn" disabled>
          <span class="btn-icon">üì•</span>
          Import <span id="pdf-import-count"></span> Participants
        </button>
      </div>
    </div>
  </div>

</div>
